# 1ï¸âƒ£ Node.js ã®å…¬å¼ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨
FROM node:18 AS builder

# 2ï¸âƒ£ ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¨­å®š
WORKDIR /app

# 3ï¸âƒ£ package.json ã¨ package-lock.json ã‚’ã‚³ãƒ”ãƒ¼ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€é©åŒ–ï¼‰
COPY package.json package-lock.json ./

# 4ï¸âƒ£ ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN npm ci

# 5ï¸âƒ£ æ®‹ã‚Šã®ã‚¢ãƒ—ãƒªã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼
COPY . .

# 6ï¸âƒ£ Vite ã‚¢ãƒ—ãƒªã‚’ãƒ“ãƒ«ãƒ‰ï¼ˆdist ãƒ•ã‚©ãƒ«ãƒ€ãŒä½œæˆã•ã‚Œã‚‹ï¼‰
RUN npm run build

# 7ï¸âƒ£ nginx ã‚’ä½¿ç”¨ã—ã¦è»½é‡ãªæœ¬ç•ªç’°å¢ƒã‚’æ§‹ç¯‰
FROM nginx:alpine AS production

# 8ï¸âƒ£ `nginx.conf` ã‚’é©åˆ‡ãªå ´æ‰€ã«ã‚³ãƒ”ãƒ¼ï¼ˆ`frontend/nginx/` ã«ã‚ã‚‹å ´åˆï¼‰
COPY nginx/nginx.conf /etc/nginx/nginx.conf

# 9ï¸âƒ£ builder ã‚¹ãƒ†ãƒ¼ã‚¸ã‹ã‚‰ãƒ“ãƒ«ãƒ‰æ¸ˆã¿ã® `dist` ãƒ•ã‚©ãƒ«ãƒ€ã‚’ã‚³ãƒ”ãƒ¼
COPY --from=builder /app/dist /usr/share/nginx/html

# ğŸ”Ÿ ãƒãƒ¼ãƒˆ 80 ã‚’å…¬é–‹
EXPOSE 80

# â“« `nginx` ã‚’èµ·å‹•
CMD ["nginx", "-g", "daemon off;"]
